{% from "_header-navbar.html" import mac_topnav %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
          <!--morrisJS-->
          <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
          <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
          <link href="https://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css" rel="stylesheet" />
    <!-- material icon -->
    <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" /> -->
    <!-- Font awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet" />  
    <title>Document</title>
</head>
<body>
    <script type="text/javascript">

class Utils
{
  calc_percent(target,total){
    return (target*100)/total;
  }
}

// data = {"Positive":300 ,"Neutral":200, "Negative":100}
function morrisjsPie(rdata,id)
{
  var ndata = [];
  var total = Object.values(rdata).reduce((partialSum, a) => partialSum + a, 0);
  var util = new Utils();

  for (const [key, val] of Object.entries(rdata))
  {
    var temp = {label : Math.round(util.calc_percent(val,total))+"%" , value:val, color:null};
    if(key.toUpperCase() === "Positive".toUpperCase())
    {
      temp["color"] = 'green';
    }
    else if(key.toUpperCase() === "Neutral".toUpperCase())
    {
      temp["color"] = 'yellow';
    }
    else if(key.toUpperCase() === "Negative".toUpperCase())
    {
      temp["color"] = 'red';
    }
    ndata.push(temp);
  };

  Morris.Donut({
    element: 'ratio-pie-'+id, 
    resize: true,
    redraw: true,
    data: ndata
  });

  $('#ratio-pie-'+id).resize(function () {
  bar.redraw();

});
    
}

// data = {"label":["Postive","Neutral","Negative"], "mean":[.85,.13,.67],"std":[.1,0,1.3],"count":[163,37,60], "max":[100,30,10] , "min":[0,1,2]}
function chartjsBubble(dt,id)
{   
    function calc(value){
      return (Math.log(value+1+1) / Math.LN10)*50;
    }

    var bg_color =  ["lightgreen", "#fdf9d6","#FF7061"]
    var border_color = ['#28a745', '#ffc107',"red" ] 

    new Chart(document.getElementById("stat-bubble-chart-"+id), {
    type: 'bubble',
    data: {
      datasets: [
        {
          label: dt["label"][0],
          backgroundColor: bg_color[0],
          borderColor: border_color[0],
          data: [{
            x: dt["skewness"][0],
            y: dt["kurtosis"][0],
            r: calc(dt["std"][0])
          }]
        }, {
          label: dt["label"][1],
          backgroundColor: bg_color[1],
          borderColor: border_color[1],
          data: [{
            x: dt["skewness"][1],
            y: dt["kurtosis"][1],
            r: calc(dt["std"][1])
          }]
        }, {
          label: dt["label"][2],
          backgroundColor: bg_color[2],
          borderColor: border_color[2],
          data: [{
            x: dt["skewness"][2],
            y: dt["kurtosis"][2],
            r: calc(dt["std"][2])
          }]
        },
      ]
    },
    options: {
        tooltips: {
          displayColors: false, //color box in tooltip
          callbacks: {
            title: function(context) {
                return dt["label"][context[0].datasetIndex];
            },

            label: function(context) {
                console.log(context)
                return "";
            },
            afterLabel: function(context) {
                var min = dt["min"][context.datasetIndex];
                var max = dt["max"][context.datasetIndex];

                return 'Mean : ' + dt["mean"][context.datasetIndex] +'\n' +
                       'Standard Deviation : ' + dt["std"][context.datasetIndex] +'\n' +
                       'Skewness : ' + dt["skewness"][context.datasetIndex] +'\n' +
                       'Kurtosis : ' + dt["kurtosis"][context.datasetIndex] +'\n' +
                       'Min : '+ min +' \t Max : '+ max;
            }                                   
          }
      },        
      legend: {
        labels : {
            boxWidth: 13,
        },
        display: false
      },    
      title: {
        display: false,
        text: 'Statistics'
      }, scales: {
        yAxes: [{ 
          scaleLabel: {
            display: true,
            labelString: "Kurtosis"
          }
        }],
        xAxes: [{ 
          scaleLabel: {
            display: true,
            labelString: "Skewness"
          }
        }]
      }
    }
});

}


function classy(dt,id)
{
  var dt_keys = Object.keys(dt);

  var pos = [];
  var neu = [];
  var neg = [];

  Object.entries(dt).forEach(([key, value]) => {
	    pos.push(dt[key][0]);
      neu.push(dt[key][1]);
      neg.push(dt[key][2]);
  });

  var horizontalBarChart = new Chart(horizontalBarChartCanvas, {
   type: 'horizontalBar',
   data: {
		labels: dt_keys,
		datasets: [{
			label: 'Positive',
			backgroundColor: "#4fb37f",
			data: pos,
		}, {
			label: 'Neutral',
			backgroundColor: "#f8cf47",
			data: neu,
		}, {
			label: 'Negative',
			backgroundColor: "#ec4c35",
			data: neg,
		}],
	},   
   options: {
    scales: {
      xAxes: [{
          stacked: true,
        }],
      yAxes: [{
          stacked: true
        }]
      },
      tooltips: {
        enabled: true
      },
      responsive: true,
      legend: {
         display: false,
         position: 'bottom',
         fullWidth: true,
         labels: {
           boxWidth: 10,
           padding: 50
         }
      },
   }
});


}



function sentiOverTime_dataProcess(data,type)
{ 
    var labels = []
    var pos_data = []
    var neu_data = []
    var neg_data = [] 

    for (const [month, content] of Object.entries(data)) {
      labels.push(month);
      pos_data.push(data[month][type][0])
      neu_data.push(data[month][type][1])
      neg_data.push(data[month][type][2])
    }

    return {"labels":labels, "Positive":pos_data, "Neutral":neu_data ,"Negative":neg_data};
}

function sentiOverTime(id,dt)
{

  var id_name = "sentiovertimeBarChart-"+id
  var drop_year_id = id_name+"_DropdownBox-Year"
  var drop_type_id = id_name+"_DropdownBox-Type"

  var densityCanvas = document.getElementById(id_name);
  Chart.defaults.global.defaultFontFamily = "sans-serif";

  var types = {"frequency":"Frequency","score":"Score"}// HARDCODED {value_in_data,name_in_drop}

  sentiOverTime_TypeDropCreate(drop_type_id,types);
  sentiOverTime_TimeDropCreate(drop_year_id,Object.keys(dt));
  
  cur_year= $("#"+ drop_year_id).val();
  cur_type= $("#"+ drop_type_id).val();

  var result = sentiOverTime_dataProcess(dt[cur_year],cur_type)

  var posData = {
    label: 'Positive',
    data: result["Positive"],
    backgroundColor: '#4fb37f',
    borderColor: '#4fb37f',
    yAxisID: "percentage"
  };
 
  var neuData = {
    label: 'Neutral',
    data: result["Neutral"],
    backgroundColor: '#f8cf47',
    borderColor: '#f8cf47'
  };

  var negData = {
    label: 'Negative',
    data: result["Negative"],
    backgroundColor: '#ec4c35',
    borderColor: '#ec4c35'
  };

  var allData = {
    labels: result["labels"],
    datasets: [posData, neuData, negData]
  };

  var chartOptions = {
    legend: {
      display: false
      },
    scales: {
      xAxes: [{
        barPercentage: .3,
        }],
      yAxes: [{
        id: "percentage"
        }]
    }

  };
 
  var barChart = new Chart(densityCanvas, {
    type: 'bar',
    data: allData,
    options: chartOptions
  });  

  sentiOverTime_DropEvent(drop_year_id,drop_type_id,barChart,dt);
}

function sentiOverTime_TimeDropCreate(drop_year_id,timedata)
{
  for(let i=0;i<timedata.length; i++)
  {
    $("#"+drop_year_id).append("<option value='"+timedata[i]+"'>"+timedata[i]+"</option>")
  }
}

function sentiOverTime_TypeDropCreate(drop_type_id,typedata)
{
  for (const [key, value] of Object.entries(typedata)) {
    $("#"+drop_type_id).append("<option value='"+key+"'>"+value+"</option>")
  }
}

function sentiOverTime_DropEvent(drop_year_id,drop_type_id,chart,mdata)
{

  function applyCurrentChange()
  {
    var cng_year = $("#"+drop_year_id).val();
    var cng_type = $("#"+drop_type_id).val();

    var data = sentiOverTime_dataProcess(mdata[cng_year],cng_type)

    chart.data.datasets[0].data = data["Positive"]
    chart.data.datasets[1].data = data["Neutral"]
    chart.data.datasets[2].data = data["Negative"]
    chart.update()
  }

  $('#'+drop_year_id).change(function(){
    applyCurrentChange();
  });

  $('#'+drop_type_id).change(function(){
    applyCurrentChange();
  });

}


function timeBar(){
  var densityCanvas = document.getElementById("sentiovertimeBarChart");

Chart.defaults.global.defaultFontFamily = "sans-serif";
// Chart.defaults.global.defaultFontSize = 18;
var dt = {}
var posData = {
  label: 'Positive',
  data: [10, 8, 5, 16, 3, 5, 7, 9.30,34,10],
  backgroundColor: '#4fb37f',
  borderColor: '#4fb37f',
  yAxisID: "percentage"
};
 
var neuData = {
  label: 'Neutral',
  data: [3.7, 8.9, 9.8, 3.7, 23.1, 9.0, 8.7, 11.0,23,20],
  backgroundColor: '#f8cf47',
  borderColor: '#f8cf47'
};

var negData = {
  label: 'Negative',
  data: [3.7, 8.9, 9.8, 3.7, 23.1, 9.0, 8.7, 11.0,30,10],
  backgroundColor: '#ec4c35',
  borderColor: '#ec4c35'
};
 
var allData = {
  labels: ["January", "February", "March", "April", "May", "June", "July", "October" ,"November", "December"],
  datasets: [posData, neuData, negData]
};
 
var chartOptions = {
  legend: {
            display: false
        },
  scales: {
    xAxes: [{
      barPercentage: .3,
      // categoryPercentage: 0.6

    }],
    yAxes: [{
      id: "percentage"
    }]
  }
};
 
var barChart = new Chart(densityCanvas, {
  type: 'bar',
  data: allData,
  options: chartOptions
});

return barChart
}        
        


window.onload=function(){
  // chartjsPie();
  var d = {"Positive":300 ,"Neutral":0, "Negative":100}
  morrisjsPie(d,0);

  var d2 = {"label":["Postive","Neutral","Negative"],"mean":[.85,.13,.67],"std":[.1,0,1.3],"count":[163,37,60],"max":[100,30,10],"min":[0,1,2], 'kurtosis': [-0.5017863301658432, -3.0, -2.0], 'skewness': [0.15155737323108837, 0.0, 0.0]}
  chartjsBubble(d2,0);

  var dt = {"Label 1": [12,3,45], "Label 2":[32,0,67], "Label 3" : [67,97,60], "Label 4":[78,45,67], "Label 5":[51,63,49], "Label 6":[89,74,63], "Label 7":[19,16,0],"Label 8":[23,45,12],"Label 9":[86,13,56]};
  classy(dt);

  var dt = {"2010": {'January': {'frequency': [20, 54, 69], 'score': [0.014975320920581847, 0.7416575539948564, 0.47198466572811926]}, 'February': {'frequency': [28, 29, 0], 'score': [0.27019657059428903, 0.8026391366661462, 0.7245331778932854]}, 'March': {'frequency': [50, 34, 8], 'score': [0.4266569130206871, 0.583202690707578, 0.15954943013992506]}, 'April': {'frequency': [29, 41, 34], 'score': [0.25976082419708224, 0.014971912997196024, 0.9046683985603279]}, 'May': {'frequency': [76, 14, 9], 'score': [0.7520765828362302, 0.7499408651944441, 0.6927642385910722]}, 'June': {'frequency': [12, 6, 96], 'score': [0.6742455643133709, 0.8833066344780404, 0.6125591534772682]}, 'July': {'frequency': [30, 73, 53], 'score': [0.6389163872242262, 0.12694838029134303, 0.7051812033298719]}, 'August': {'frequency': [0, 68, 98], 'score': [0.21451801292675554, 0.8070890149647078, 0.07193270140178609]}, 'September': {'frequency': [18, 15, 10], 'score': [0.405305775918424, 0.7674856203724286, 0.6941462453925861]}, 'October': {'frequency': [21, 89, 87], 'score': [0.2554169951512726, 0.08537604940338084, 0.5523232466034452]}, 'November': {'frequency': [87, 46, 70], 'score': [0.3653352109410617, 0.07941292388717747, 0.6552337578979928]}, 'December': {'frequency': [68, 85, 62], 'score': [0.05999928331116977, 0.41872340905441974, 0.4530549045808434]}}, "2011": {'January': {'frequency': [74, 2, 8], 'score': [0.6080534092518152, 0.36601931399710486, 0.28058050015153846]}, 'February': {'frequency': [76, 22, 99], 'score': [0.06935119368508824, 0.5949777423133458, 0.693142697184855]}, 'March': {'frequency': [79, 45, 44], 'score': [0.4306498306598161, 0.22028201142635906, 0.8009968786467798]}, 'April': {'frequency': [39, 87, 82], 'score': [0.24621032893588235, 0.6521467290266101, 0.4751404608090166]}, 'May': {'frequency': [91, 49, 67], 'score': [0.3747431901327959, 0.534531791944611, 0.24945148272481443]}, 'June': {'frequency': [48, 57, 57], 'score': [0.16565223439256882, 0.4290125395669673, 0.3211022347988395]}, 'July': {'frequency': [8, 87, 77], 'score': [0.32625567850530857, 0.3198366536762044, 0.7657590866045506]}, 'August': {'frequency': [98, 4, 20], 'score': [0.8395186145113471, 0.30669831753600363, 0.34660058646617165]}, 'September': {'frequency': [19, 19, 90], 'score': [0.1693590349915679, 0.19774144405143945, 0.6704304871871186]}, 'October': {'frequency': [86, 73, 72], 'score': [0.9137878138716583, 0.12244918106173708, 0.5633200581261851]}, 'November': {'frequency': [62, 94, 84], 'score': [0.321372460554043, 0.23436930142940549, 0.2724443686196202]}, 'December': {'frequency': [61, 9, 43], 'score': [0.044410768265116696, 0.9993245868886923, 0.8377430482475109]}}}
  sentiOverTime(0,dt);

  // var sentiOtime = timeBar();
  // sentiOverTime_DropEvent(sentiOtime);
  // sentiOverTime_DropCreate([2011,2012])

  // data1 = {}
  // data2 = {}
  // labels = ["Positive","Neutral","Negative"]
  // for(let i=0;i<labels.length;i++)
  // {
  //   data1[labels[i]] = []
  //   data2[labels[i]] = []
  //   for(let j=0;j<10;j++){
  //     data1[labels[i]].push(Math.random());
  //     data2[labels[i]].push(Math.random());
  //   }
  // }

}



</script>
<!-- <style>
    @import url(https://fonts.googleapis.com/css?family=Open+Sans);

body{
    background-color: #f6f9fb;
    /* font-family: 'Montserrat' */
}
</style> -->

  <div class="container-fluid">
  {{ mac_topnav(file,3) }}

  {% for row in data %}

    <div class="row">
      <div class="col"> 
        <div class="card">
          <div class="card-body">
            <div class="row">
              <h5 class="card-title">Aespect: A1</h5>
                <div class="d-flex justify-content-around">
                  <div class="col-3 card rounded-0 h-100">
                  <span class="m-2" style="padding-left: 10px;">Sentiment Ratio</span>
                  <div style="height: 230px;" id="ratio-pie-0"></div>
                  </div>  
                  <div class="col-5 card rounded-0 h-100">
                    <span class="m-2" style="padding-left: 10px;">Statistics</span>
                    <canvas id="stat-bubble-chart-0" class="p-3" height="280"></canvas>
                  </div>  
                  <div class="col-4 card rounded-0 h-100">
                    <span class="m-2" style="padding-left: 10px;"><strong>Category</strong></span>
                    <canvas id="horizontalBarChartCanvas" class="p-3" height="250"></canvas>
                  </div>                   
                </div>
              </div>
              
              <div class="row h-100">
                <div class="d-flex justify-content-around">

                  <div class="col-4 card rounded-0 h-100">
                    <img src="https://www.pngkit.com/png/detail/936-9364760_transparent-word-cloud-png.png" alt="Transparent Word Cloud Png@pngkit.com">
                  </div>

                  <div class="col card rounded-0 m-0">
                    <div class="row m-2" style="margin: 0;">
                      <div class="col"><strong>Sentiment Ovetime</strong></div>
                      <div class="col d-flex justify-content-end">
                        <span>Filter by year: </span>
                        <select name="" id="sentiovertimeBarChart-0_DropdownBox-Year">
      
                        </select>
                        <select name="" id="sentiovertimeBarChart-0_DropdownBox-Type">
      
                        </select>
                      </div>
                    </div>
                      <canvas class=" p-4" id="sentiovertimeBarChart-0" height="300"></canvas> 
                  </div>

                </div> 
              </div>

            </div>
          </div>
        </div>
      </div>

  {% endfor %}

      <div class="row">
        <div class="col">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Overall Score</h5>
                    word cloud or any frequency chart goes here
                    try heatmap
                </div>
            </div>
        </div>
    </div>      
  </div>

</body>
</html>